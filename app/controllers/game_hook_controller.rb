class GameHookController < ApplicationController
  skip_before_action :verify_authenticity_token

  def create_message
    user = User.find_by(steam_name: params["value2"])
    return render(json: NO_USERS_ASCII.split("\n")) unless user && !user.silent_mode

    payload = {
      chat_id: Encryptor::Encryptor.decrypt(user.chat_name),
      text: "ðŸŸ¢ Ð’Ð°ÑˆÐ° Ñ‡ÐµÑ€Ð³Ð° #{user.steam_name}\n\nÐ“Ñ€Ð°: #{params["value1"]}\nÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ Ñ…Ð¾Ð´: #{params["value3"]}"
    }

    uri = URI.parse("https://api.telegram.org/bot#{Rails.application.credentials.telegram[:bot]}/sendMessage")
    Net::HTTP.post_form(uri, payload)

    respond_to do |format|
      format.json { render json: params.to_json }
    end
  end
  NO_USERS_ASCII = <<~NO_BITCHES.freeze
    â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”No users?â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    â €â£žâ¢½â¢ªâ¢£â¢£â¢£â¢«â¡ºâ¡µâ£â¡®â£—â¢·â¢½â¢½â¢½â£®â¡·â¡½â£œâ£œâ¢®â¢ºâ£œâ¢·â¢½â¢â¡½â£
    â ¸â¡¸â œâ •â •â â¢â¢‡â¢â¢½â¢ºâ£ªâ¡³â¡â£Žâ£â¢¯â¢žâ¡¿â£Ÿâ£·â£³â¢¯â¡·â£½â¢½â¢¯â£³â£«â ‡
    â €â €â¢€â¢€â¢„â¢¬â¢ªâ¡ªâ¡Žâ£†â¡ˆâ šâ œâ •â ‡â —â â¢•â¢¯â¢«â£žâ£¯â£¿â£»â¡½â£â¢—â£—â â €
    â €â ªâ¡ªâ¡ªâ£ªâ¢ªâ¢ºâ¢¸â¢¢â¢“â¢†â¢¤â¢€â €â €â €â €â ˆâ¢Šâ¢žâ¡¾â£¿â¡¯â£â¢®â ·â â €â €â €
    â €â €â €â ˆâ Šâ †â¡ƒâ •â¢•â¢‡â¢‡â¢‡â¢‡â¢‡â¢â¢Žâ¢Žâ¢†â¢„â €â¢‘â£½â£¿â¢â ²â ‰â €â €â €â €
    â €â €â €â €â €â¡¿â ‚â  â €â¡‡â¢‡â •â¢ˆâ£€â €â â ¡â £â¡£â¡«â£‚â£¿â ¯â¢ªâ °â ‚â €â €â €â €
    â €â €â €â €â¡¦â¡™â¡‚â¢€â¢¤â¢£â £â¡ˆâ£¾â¡ƒâ  â „â €â¡„â¢±â£Œâ£¶â¢â¢Šâ ‚â €â €â €â €â €â €
    â €â €â €â €â¢â¡²â£œâ¡®â¡â¢Žâ¢Œâ¢‚â ™â ¢â â¢€â¢˜â¢µâ£½â£¿â¡¿â â â €â €â €â €â €â €â €
    â €â €â €â €â ¨â£ºâ¡ºâ¡•â¡•â¡±â¡‘â¡†â¡•â¡…â¡•â¡œâ¡¼â¢½â¡»â â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â£¼â£³â£«â£¾â£µâ£—â¡µâ¡±â¡¡â¢£â¢‘â¢•â¢œâ¢•â¡â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â£´â£¿â£¾â£¿â£¿â£¿â¡¿â¡½â¡‘â¢Œâ ªâ¡¢â¡£â££â¡Ÿâ €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â¡Ÿâ¡¾â£¿â¢¿â¢¿â¢µâ£½â£¾â£¼â£˜â¢¸â¢¸â£žâ¡Ÿâ €â €â €â €â €â €â €â €â €â €â €â €â €
    â €â €â €â €â â ‡â ¡â ©â¡«â¢¿â£â¡»â¡®â£’â¢½â ‹â €â €â €â €â €â €â €â €â €â €â €â €â €â €
    â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  NO_BITCHES
end
